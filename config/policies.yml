# AI-Intercom Approval Policies
# Rules are evaluated top-to-bottom (first match wins)

defaults:
  require_approval: once

rules:
  # Human dispatch from Telegram: auto-approve
  - from: "human"
    to: "*"
    approval: never
    label: "Human dispatch - no approval needed"

  # Local same-machine communications: auto-approve
  - from: "serverlab/*"
    to: "serverlab/*"
    approval: always_allow
    label: "Local serverlab communications"

  # Cross-machine agent-to-agent: auto-approve ask and send
  - from: "serverlab/*"
    to: "*"
    type: ask
    approval: never
    label: "Serverlab agents can ask any machine"

  - from: "serverlab/*"
    to: "*"
    type: send
    approval: never
    label: "Serverlab agents can send to any machine"

  - from: "serverlab/*"
    to: "*"
    type: start_agent
    approval: never
    label: "Serverlab agents can start agents anywhere"

  # Read-only queries: auto-approve
  - from: "*"
    to: "*"
    type: send
    message_pattern: "status|ping|health|check|list"
    approval: never
    label: "Read-only status queries"

  # Other agent launches require approval
  - from: "*"
    to: "*"
    type: start_agent
    approval: once
    label: "Non-serverlab agent launches require approval"
